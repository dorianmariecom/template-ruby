#!/usr/bin/env ruby

require "optparse"
require_relative "../lib/template-ruby"

options = {}

OptionParser.new do |opts|
  opts.banner = "Usage: #{$PROGRAM_NAME} [options]"

  opts.on("-i INPUT", "--input=INPUT", "Input in the template language") do |input|
    if File.exists?(input)
      input = File.read(input)
    end

    options[:input] = input
  end

  opts.on("-c CONTEXT", "--context=CONTEXT", "Context in the code language") do |context|
    if File.exists?(context)
      context = File.read(context)
    end

    options[:context] = context
  end

  opts.on("-p", "--parse", "Get parser results for input") do |parse|
    options[:parse] = parse
  end
end.parse!

input = options.fetch(:input, "")
context = options.fetch(:context, "")

if options[:parse]
  pp ::Template::Parser::Template.new.parse(input)
else
  puts Template.render(input, context)
end
